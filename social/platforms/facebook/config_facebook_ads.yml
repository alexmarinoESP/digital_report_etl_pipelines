platform:
  api_base_url: "https://graph.facebook.com"
  api_version: "v19.0"

fb_ads_audience_adset:
  type: get_audience_targeting  # Use special adapter method that extracts audiences
  date_preset:  last_7d
  fields: fields_ads_audience_adset
  processing:
    modify_name:
      cols: ['name']  # Audience name from API
    add_row_loaded_date:
      params: None

  scope: account
  query:
    column_name:
      - audience_id
      - adset_id
  # APPEND mode with explicit PK
  append:
    pk_columns:
      - audience_id
      - adset_id
  delete:
    period: CURRENT_DATE()-90

fb_ads_campaign:
  type: get_campaigns
  fields: fields_ads_campaign
  date_preset: last_7d
  processing:
    rename_column:
      renaming:
        id: campaign_id
    convert_unix_timestamp_to_date:
      columns: [created_time]
    convert_nat_to_nan:
      columns: [created_time]
  scope: account
  query:
    column_name:
      - campaign_id
  # Changed to upsert for full row updates
  upsert:
    pk_columns:
      - campaign_id


fb_ads_insight:
  type: get_insights
  fields: fields_ads_insight
  date_preset: maximum
  processing:
    modify_name:
      cols: ['ad_name', 'name']
    drop_columns:
      cols: ['date_stop','date_start']
    aggregate_by_entity:  # Aggregate metrics by ad_id (remove date dimension)
      group_columns: null  # Auto-detect (ad_id)
      metric_columns: null
      agg_method: 'sum'
    add_row_loaded_date:
      params: None

  query:
    column_name:
      - ad_id  # Only ad_id, no dates
  upsert:  # UPSERT = MERGE (replace values, don't increment)
    pk_columns:
      - ad_id
  scope: account


fb_ads_insight_actions:
  type: get_insights
  fields: fields_ads_insight_actions
  date_preset: last_14d
  processing:
    convert_actions_to_df:
      params: None
    extract_custom_conversion_id:
      params: None
    nan_conversion:
      params: None
    aggregate_by_entity:  # Aggregate metrics by ad_id + action_type
      group_columns: ['ad_id', 'action_type']  # Explicit grouping
      metric_columns: ['value']
      agg_method: 'sum'
    add_row_loaded_date:
      params: None

  query:
    column_name:
      - ad_id
      - action_type
  scope: account
  upsert:  # UPSERT = MERGE (replace values, don't increment)
    pk_columns:
      - ad_id
      - action_type
#
#
##fb_ads_ad_creatives:
##  type: get_ad_creatives
##  fields: fields_ads_creative
##  date_preset: last_3d
##  processing:
##    rename_columns:
##      col_dict:
##        id: ad_id
##        actor_id: page_id
##    utf_8_encoding:
##      cols: ['name','body']
##  query:
##    column_name:
##      - account_id
##      - ad_id
##  scope: account
##
##
###fb_ads_ad_account:
###  type: get_owned_ad_accounts
###  fields: fields_account_info
###
###  processing:
###    convert_to_df:
###      params: None
###    add_companyid:
###      params: None
###    deal_with_date:
###      table: 'fb_ads_ad_account'
###    add_row_loaded_date:
###      params: None
###
###  scope: business
###  query:
###    column_name:
###      - account_id
###  update:
###    fields_id:
###      - account_id
###    fields_update:
###      - age
##
##
fb_ads_custom_conversion:
  type: get_custom_conversions
  fields: fields_custom_convers
  date_preset: last_7d
  processing:
    rename_column:
      renaming:
        id: conversion_id
    extract_pixel_rule:
      params: None

  query:
    column_name:
      - conversion_id
  # APPEND mode with explicit PK
  append:
    pk_columns:
      - conversion_id
  scope: account


fb_ads_ad_set:
  type: get_ad_sets
  date_preset:  last_7d # this_month
  fields: fields_ads_adset
  processing:
    convert_unix_timestamp_to_date:
      columns: ['start_time','end_time']
  scope: account
  query:
    column_name:
      - id
  # Changed to upsert for full row updates
  upsert:
    pk_columns:
      - id
##

####
####
####
####
####
