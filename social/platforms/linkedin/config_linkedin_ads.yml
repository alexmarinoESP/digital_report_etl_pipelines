platform:
  api_base_url: "https://api.linkedin.com/rest"
  api_version: "202509"  # Must match old project version

linkedin_ads_creative:
  request: get_creatives
  type: CREATIVES
  q: criteria
  nested_element: ['servingHoldReasons']
  #fields: ['id', 'campaign_id', 'name', 'intendedStatus', 'type', 'lastModifiedAt', 'createdAt', 'account']
  processing:
    extract_id_from_urn:
      columns: [id, campaign, account]  # MUST use 'columns' not 'cols'
    rename_column:
      renaming:
        status: status_0
        campaign: campaign_id
        intendedStatus: status
    add_row_loaded_date: None  # None or params: None in old code
  query:
    column_name:
      - id
  # Changed to upsert for full row updates
  upsert:
    pk_columns:
      - id
  pagination:
    start: 0
    count: 100  # Adjust based on your API limits
    loop_while_more: true

linkedin_ads_campaign:
  request: get_campaigns
  q: search
  pageSize: '10000'  # Changed from 1000 to 10000 (old working value)
  type: CAMPAIGN
  pagination: True
  nested_element: ['totalBudget', 'dailyBudget', 'unitCost', 'runSchedule']
  #fields: ['objectiveType','runSchedule','optimizationTargetType','costType','name','id','status', 'totalBudget','dailyBudget','account','unitCost']
  query:
    column_name:
      - id
  processing:
    response_decoration:
      field: account
      new_col_name: null
    convert_int:
      columns: ['id']
    convert_unix_timestamp_to_date:
      columns: ['runSchedule_start', 'runSchedule_end']
    rename_column:
      renaming:
        runSchedule_start: start_date
        runSchedule_end: end_date
    add_row_loaded_date: None  # None or params: None in old code
    convert_nat_to_nan:
      columns: ['end_date','start_date']
    modify_name:
      columns: ['name']  # MUST use 'columns' not 'cols'
  # Changed from 'update' to 'upsert' for full row updates
  upsert:
    pk_columns:
      - id
    # All fields will be updated (INSERT new + UPDATE all fields for existing)


linkedin_ads_insights:
  request: get_insights
  type: ANALYTICS
  q: analytics
  nested_element: ['dateRange']
  fields: ['actionClicks','adUnitClicks','clicks','comments','costInLocalCurrency', 'landingPageClicks','likes','reactions','shares','totalEngagements','dateRange','pivotValues','impressions','externalWebsiteConversions','conversionValueInLocalCurrency']
  query:
    column_name:
      - creative_id
      - date  # Add date to query columns (built from dateRange components)
  processing:
    # Note: Using timeGranularity=DAILY to get daily breakdown with date dimension
    # This allows maintaining historical data in source table (730 days)
    replace_nan_with_zero:
      columns: ['costInLocalCurrency', 'conversionValueInLocalCurrency']
    response_decoration:
      field: pivotValues
      new_col_name: creative_id
    build_date_field: None  # Build 'date' column from dateRange_start_year/month/day
    add_row_loaded_date: None
  # UPSERT: Loads daily data into _source table with date in PK
  # Then aggregates all historical data from _source to target table
  upsert:
    pk_columns:
      - creative_id
      - date  # Include date in PK for source table
    aggregate_to_target: true  # After loading source, aggregate to target table

linkedin_ads_campaign_audience:
  q: search
  pageSize: '10000'  # Changed from 1000 to 10000 (old working value)
  type: CAMPAIGN
  request: get_campaigns
  #fields: ['targetingCriteria','id']
  query:
    column_name:
      - id
  processing:
    convert_string:
      columns:
      - id
    add_row_loaded_date: None  # None or params: None in old code
  # Changed to upsert for full row updates
  upsert:
    pk_columns:
      - id

linkedin_ads_account:
  q: search
  request: get_account
  type: ACCOUNT
  #fields: ['name', 'currency', 'id', 'status']
  query:
    column_name:
      - id
  processing:
    add_company:
      params: None
    add_row_loaded_date: None  # None or params: None in old code
  # Changed to upsert for full row updates
  upsert:
    pk_columns:
      - id
#
#
#
#
linkedin_ads_audience:
  q: accounts
  request: get_audience
  type: AUDIENCE
  pagination: True
  count: '400'
  #fields: ['account','id','name','description']
  query:
    column_name:
      - id
  processing:
    modify_urn_li_sponsoredAccount:
      params: None
    add_row_loaded_date: None  # None or params: None in old code
#
#


#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
